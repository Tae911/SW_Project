<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>결제 테스트</title>
</head>
<body>
  <!-- PortOne JS SDK 로드 -->
  <script src="https://cdn.iamport.kr/v1/iamport.js"></script>

  <h2>결제 테스트</h2>
  <button onclick="requestPay()">결제하기</button>

  <script>
    function requestPay() {
      const IMP = window.IMP;
      IMP.init("imp83146667"); // 본인의 가맹점 식별코드로 대체

      IMP.request_pay({
        pg: "kakaopay",
        pay_method: "card",
        merchant_uid: "order_no_" + new Date().getTime(),
        name: "포트원 결제테스트 상품",
        amount: 1000,
        buyer_email: "test@example.com",
        buyer_name: "테스트유저",
        buyer_tel: "01012345678",
      }, function (rsp) {
        if (rsp.success) {
          alert("결제 성공! 서버로 결제 검증 요청을 보냅니다.");
          fetch("/api/pay/verify", {
            method: "POST",
            headers: { "Content-Type": "application/json; charset=utf-8" },
            body: JSON.stringify({ imp_uid: rsp.imp_uid, merchant_uid: rsp.merchant_uid })
          })
          .then(res => res.json())
          .then(data => alert("서버 확인 성공: " + JSON.stringify(data)))
          .catch(err => alert("검증 실패: " + err));
        } else {
          alert("결제 실패: " + rsp.error_msg);
        }
      });
    }
  </script>
</body>
</html>
